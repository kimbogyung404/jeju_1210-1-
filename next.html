<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no,user-scalable=no" />
<title>Jeju Words â€¢ ì°¾ê¸° ê²Œì„</title>
<style>
  /* ê³ ìš´ë‹ì›€ (ê²°ê³¼ í™”ë©´ / ì¹© / ë²„íŠ¼ìš©) */
  @font-face {
    font-family: 'GowunDodum';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2108@1.1/GowunDodum-Regular.woff')
         format('woff');
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }

  /* SUIT Bold (ë‹¨ì–´ / UIìš©) */
  @font-face {
    font-family: 'SUIT';
    src: url('https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT-Bold.woff2')
         format('woff2');
    font-weight: 700;
    font-style: normal;
    font-display: swap;
  }

  html, body {
    height: 100%;
  }

  body {
    margin: 0;
    overflow: hidden;
    background-color: #45E0E8;  /* ì›ë˜ ì—ë©”ë„ë“œ ìƒ‰ */
    font-family: "ë‹ì›€","Dotum",sans-serif;
    position: relative;
  }

  /* ìƒë‹¨ ì „ì²´ í–‰: ì¤‘ì•™ ì¹´ë“œ + ì˜¤ë¥¸ìª½ ì¹´ë“œ 2ê°œ */
  .hud-row {
    position: fixed;
    top: 120px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 4;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    gap: 40px;
    width: calc(100% - 80px);
    max-width: 1060px;
    box-sizing: border-box;
  }

  /* ì¤‘ì•™ í° ì¹´ë“œ */
  .hud-main {
    flex: 1;
    max-width: 640px;
    background: rgba(18, 18, 18, 0.2);
    border-radius: 12px;
    padding: 18px 18px 16px;
    color: #FFFFFF;
    font-family: 'SUIT', sans-serif;
    text-align: center;
    box-sizing: border-box;
  }

  .hud-main-title {
    font-size: 22px;
    margin-bottom: 8px;
  }

  .hud-main-sub {
    font-size: 22px;
    opacity: 0.95;
    margin-bottom: 10px;
  }

  /* ë¶€ì—° ì„¤ëª…ì„ í° ì œëª©ì²˜ëŸ¼ */
  .main-big-title {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 20px;
  }

  .hud-main-body {
    margin-top: 6px;
  }

  .input-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .answer-input {
    flex: 1;
    max-width: 380px;
    padding: 12px 16px;
    border-radius: 6px;
    border: none;
    font-family: 'SUIT', sans-serif;
    font-size: 20px;
    font-weight: 300;
    outline: none;
    text-align: center;
    box-shadow: none;
  }

  .answer-btn {
    font-family: 'SUIT', sans-serif;
    font-weight: 300;
    font-size: 20px;
    color: #FFFFFF;
    padding: 14px 40px;
    border: none;
    border-radius: 10px;
    background: #0F3253;
    cursor: pointer;
    transition: 0.2s;
    box-shadow: none;
  }

  .answer-btn:hover {
    background: #0D2943;
    transform: translateY(-1px);
  }

  .answer-display {
    display: none;
    margin: 10px auto 0;
    max-width: 380px;
    background: #FFFFFF;
    color: #0F3253;
    border-radius: 6px;
    padding: 10px 14px;
    font-family: 'SUIT', sans-serif;
    font-size: 20px;
    text-align: center;
    box-shadow: none;
  }

  .answer-feedback {
    margin-top: 8px;
    font-size: 16px;
    min-height: 14px;
    opacity: 0.95;
  }

  /* ì˜¤ë¥¸ìª½ ì¹´ë“œ ë¬¶ìŒ (ì‹œê°„, ì ìˆ˜) */
  .hud-side {
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding-top: 12px;
  }

  .hud-pill {
    border-radius: 100px;
    background: rgba(18, 18, 18, 0.5);
    color: #FFFFFF;
    font-family: 'SUIT', sans-serif;
    font-size: 20px;
    font-weight: 300;
    padding: 12px 28px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;
    box-sizing: border-box;
    box-shadow: none;
  }

  /* ì œì£¼ì–´ ë‹¨ì–´ ë ˆì´ì–´ (ë§¨ ë’¤) */
  .word-layer {
    position: fixed;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
    z-index: 1;
  }

  .word {
    position: absolute;
    color: #FFFFFF;
    font-size: 35px;
    white-space: nowrap;
    user-select: none;
    font-family: 'SUIT', sans-serif;
    font-weight: 600;
    transition: transform 0.25s ease, opacity 0.25s ease;
  }

  .word-clicked {
    transform: scale(1.1);
  }

  /* ì¤„ ìº”ë²„ìŠ¤ (ë‹¨ì–´ ìœ„, ì¹´ë“œ/íƒ€ì´ë¨¸ ì•„ë˜) */
  canvas {
    position: fixed;
    inset: 0;
    display: block;
    z-index: 2;
  }

  /* ğŸ¦µ legs.gif â€” ì œì¼ ì•„ë˜ ë ˆì´ì–´ */
  .legs-gif {
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%) scale(0.5);
    transform-origin: top center;
    z-index: 0;
    pointer-events: none;
  }

  /* ===========================
      ê²°ê³¼ í™”ë©´ (ì˜ìƒ ë°°ê²½ í˜ì´ì§€)
  ============================ */
  #quiz-result-screen {
    display: none;
    position: fixed;
    inset: 0;
    background: #000;
    z-index: 40;
    opacity: 0;
    transition: opacity 0.8s ease;
    overflow: hidden;
  }

  .result-video {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  #quiz-result-screen .result-inner {
    position: relative;
    z-index: 1;
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 40px 20px;
    box-sizing: border-box;
    color: #0F3253;
  }

  /* ê²°ê³¼ íƒ€ì´í‹€/ë¶€ì œ ê³ ìš´ë‹ì›€ */
  #quiz-result-screen .result-inner h2 {
    font-size: 46px;
    margin-bottom: 16px;
    font-family: 'GowunDodum', sans-serif;
  }

  .result-sub {
    font-size: 24px;
    margin-bottom: 32px;
    font-family: 'GowunDodum', sans-serif;
  }

  .result-words-panel {
    margin-bottom: 40px;
  }

  .result-words-cloud {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px 16px;
  }

  .result-word-chip {
    padding: 8px 14px;
    border-radius: 999px;
    background: #FFFFFF;
    color: #0F3253;
    font-size: 24px;
    white-space: nowrap;
    position: relative;
    will-change: transform;
    animation: wordFloatUpDown 1.6s ease-in-out infinite;
    font-family: 'GowunDodum', sans-serif;
    box-shadow: none;
  }

  @keyframes wordFloatUpDown {
    0%, 100% {
      transform: translateY(-8px);
    }
    50% {
      transform: translateY(8px);
    }
  }

  .result-word-chip:nth-child(even) {
    animation-delay: -0.8s;
  }

  .result-btn-wrap {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
  }

  .start-btn {
    font-family: 'GowunDodum', sans-serif;
    font-size: 16px;
    padding: 10px 28px;
    border-radius: 999px;
    border: none;
    background: #0F3253;
    color: #FFFFFF;
    cursor: pointer;
    box-shadow: none;
  }

  .start-btn:hover {
    background: #0D2943;
  }

  /* ğŸ‘‰ â€œì²˜ìŒìœ¼ë¡œâ€ ë²„íŠ¼ í…ìŠ¤íŠ¸ í¬ê¸°ë§Œ í‚¤ìš´ ë²„ì „ */
  #quiz-result-screen .start-btn {
    font-size: 24px !important;
  }
</style>

</head>
<body>

<!-- ìƒë‹¨ HUD -->
<div class="hud-row">
  <!-- ì¤‘ì•™ í° ì¹´ë“œ -->
  <div class="hud-main">
    <!-- ì œëª©ì€ ìˆ¨ê¸°ê³  -->
    <div id="hud-main-title" class="hud-main-title" style="display:none;"></div>
    <!-- ë¶€ì—° ì„¤ëª…ì„ í° ì œëª©ì²˜ëŸ¼ -->
    <div id="hud-main-sub" class="hud-main-sub main-big-title">
      ì œì£¼ì–´ë¥¼ ì°¾ì•„ ì•„ë˜ ì…ë ¥ì¹¸ì— ì ì–´ë³´ì„¸ìš”.
    </div>

    <div class="hud-main-body">
      <div id="input-row" class="input-row">
        <input
          id="answer-input"
          class="answer-input"
          type="text"
          placeholder="ì°¾ì€ ì œì£¼ì–´ë¥¼ ì ì–´ë³´ì„¸ìš”"
        />
        <button id="answer-btn" class="answer-btn">ì…ë ¥</button>
      </div>

      <!-- ì •ë‹µ ìƒíƒœì—ì„œ ë³´ì—¬ì¤„ í° ë°•ìŠ¤ -->
      <div id="answer-display" class="answer-display"></div>
    </div>

    <div id="answer-feedback" class="answer-feedback"></div>
  </div>

  <!-- ì˜¤ë¥¸ìª½ ì‘ì€ ì¹´ë“œ 2ê°œ -->
  <div class="hud-side">
    <div id="time-pill" class="hud-pill">ë‚¨ì€ ì‹œê°„ | 00:50</div>
    <div id="score-pill" class="hud-pill">ë§ì¶˜ ì •ë‹µ | 0ê°œ</div>
  </div>
</div>

<!-- ì œì£¼ì–´ ë‹¨ì–´ ë ˆì´ì–´ (ë§¨ ë’¤) -->
<div class="word-layer" id="words"></div>

<!-- ğŸ¦µ GIF (ìƒë‹¨ ì¤‘ì•™, ì¤„ ì•„ë˜ ë ˆì´ì–´) -->
<img src="legs.gif" alt="legs animation" class="legs-gif" />

<!-- ì¤„ ìº”ë²„ìŠ¤ -->
<canvas id="cv"></canvas>

<!-- ê²°ê³¼ í™”ë©´ (ì˜ìƒ ë°°ê²½) -->
<div id="quiz-result-screen">
  <video
    class="result-video"
    autoplay
    muted
    loop
    playsinline
  >
    <source src="https://cdn.midjourney.com/video/1905a823-3bac-47c0-a0f9-32bc324c4328/1.mp4" type="video/mp4">
  </video>

  <div class="result-inner">
    <h2 id="result-title">ì œì£¼ì–´ 0ê°œ íšë“!</h2>
    <p class="result-sub">ì œì£¼ì–´ ì‚´ë¦¬ê¸°ì— ë™ì°¸í–ˆì–´ìš”</p>

    <div class="result-words-panel" id="result-words-panel">
      <div class="result-words-cloud" id="result-words-cloud"></div>
    </div>

    <div class="result-btn-wrap">
      <button class="start-btn" onclick="goToMainFromResult()">ì²˜ìŒìœ¼ë¡œ</button>
    </div>
  </div>
</div>

<!-- ğŸŒŠ ë°°ê²½ íŒŒë„ ì†Œë¦¬ (ê²Œì„ ì‹œì‘ ~ ê²°ê³¼ í˜ì´ì§€ê¹Œì§€ ì¬ìƒ) -->
<audio id="bg-waves" src="Sound of waves.mp3" preload="auto" loop></audio>

<script>
(() => {
  /* ===========================
     ë‹¨ì–´ / ëœ» ë°ì´í„°
  ============================ */
  const WORDS = [
    "ëŠë‹¨ì†","ì˜¤ë¥´ì†","ë…ì„¸ê¸°","êµ¬ë•","ìš”ë§ì§€ë‹¤","ìª¼ë½","í—ˆë²…","ë‹¬ì½”ë¡¬",
    "ë§ˆë†","ë°”ë†","ì‹¬ë°©","ì ë…€","ë„ìƒˆê¸°","ë°°ë˜ë¡±","ìƒë»¬"
  ];

  const MEANINGS = {
    "ëŠë‹¨ì†": "ëŠë‹·ì—†ì´ ì°¾ì•„ì˜¨ ì†ë‹˜",
    "ì˜¤ë¥´ì†": "ì˜¤ë¥¸ì†",
    "ë…ì„¸ê¸°": "ê³„ë€",
    "êµ¬ë•": "ë°”êµ¬ë‹ˆ",
    "ìš”ë§ì§€ë‹¤": "ì•¼ë¬´ì§€ë‹¤",
    "ìª¼ë½ì§„": "ë–«ì€",
    "í—ˆë²…": "ë¬¼ì„ ê¸¸ì–´ ë‚˜ë¥´ëŠ” ë¬¼ë™ì´",
    "ë‹¬ì½”ë¡¬": "ë‹¬ì½¤í•œ",
    "ë§ˆë†": "ë§ˆëŠ˜",
    "ë°”ë†": "ë°­ì—ì„œ ë‚˜ëŠ” ë†ì‘ë¬¼",
    "ì‹¬ë°©": "ë¬´ë‹¹",
    "ì ë…€": "í•´ë…€",
    "ë„ìƒˆê¸°": "ë¼ì§€",
    "ë°°ë˜ë¡±": "ì§ì„ ë‚˜ë¥¼ ë•Œ ì“°ëŠ” ë„êµ¬",
    "ìƒë»¬": "ëˆˆì¹˜ë¥¼ ì§€ë‚˜ì¹˜ê²Œ ë³´ëŠ” íƒœë„"
  };

  const wordLayer = document.getElementById("words");
  const answerInput = document.getElementById("answer-input");
  const answerBtn = document.getElementById("answer-btn");
  const answerDisplay = document.getElementById("answer-display");
  const inputRow = document.getElementById("input-row");
  const answerFeedbackEl = document.getElementById("answer-feedback");
  const mainTitleEl = document.getElementById("hud-main-title");
  const mainSubEl = document.getElementById("hud-main-sub");
  const timePill = document.getElementById("time-pill");
  const scorePill = document.getElementById("score-pill");

  const resultScreen = document.getElementById("quiz-result-screen");
  const resultTitleEl = document.getElementById("result-title");
  const resultWordsPanel = document.getElementById("result-words-panel");
  const resultWordsCloud = document.getElementById("result-words-cloud");

  let score = 0;
  const foundSet = new Set();     // ë§ì¶˜ ë‹¨ì–´ë“¤
  let correctWords = [];          // ê²°ê³¼ í™”ë©´ ì¹©ì— ì“¸ ë‹¨ì–´ë“¤
  let wrongAnswers = [];          // í‹€ë¦° ë‹µ ë¦¬ìŠ¤íŠ¸ (í˜„ì¬ëŠ” UIì— ì‚¬ìš© ì•ˆ í•¨)
  let feedbackTimer = null;       // ì •ë‹µ ë°•ìŠ¤ í›„ ì¸í’‹ ì¬í‘œì‹œ íƒ€ì´ë¨¸

  /* ===== ì ìˆ˜ ì—…ë°ì´íŠ¸ ===== */
  function updateScore() {
    if (!scorePill) return;
    scorePill.textContent = `ë§ì¶˜ ì •ë‹µ | ${score}ê°œ`;
  }

  /* ===== ë‹¨ì–´ ë°°ì¹˜ (ì„œë¡œ ì•ˆ ê²¹ì¹˜ê³ , ë‹¨ì–´ë„ ì¤‘ë³µ ì—†ì´) ===== */
  function placeWords() {
    wordLayer.innerHTML = "";

    const W = window.innerWidth;
    const H = window.innerHeight;
    const minY = 310; // ì¹´ë“œ ì˜ì—­ ì•„ë˜ë¶€í„° ë°°ì¹˜

    // ì•„ì§ ëª» ì°¾ì€ ë‹¨ì–´ë“¤ë§Œ ê°€ì ¸ì˜¤ê¸°
    const availableWords = WORDS.filter(w => !foundSet.has(w));
    const count = availableWords.length;

    // ë‹¨ì–´ ìˆœì„œ ì„ê¸°
    const shuffled = [...availableWords];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }

    const placed = [];

    function overlap(a, b) {
      return !(
        a.x + a.w < b.x ||
        b.x + b.w < a.x ||
        a.y + a.h < b.y ||
        b.y + b.h < a.y
      );
    }

    for (let i = 0; i < count; i++) {
      const text = shuffled[i];

      const el = document.createElement("div");
      el.className = "word";
      el.textContent = text;
      el.style.left = "0px";
      el.style.top = "0px";

      wordLayer.appendChild(el);

      const rect = el.getBoundingClientRect();
      const w = rect.width + 10;
      const h = rect.height + 10;

      let x, y, ok, tries = 0;
      do {
        x = Math.random() * Math.max(1, (W - w));
        y = minY + Math.random() * Math.max(1, (H - minY - h));
        ok = true;
        for (const p of placed) {
          if (overlap({ x, y, w, h }, p)) {
            ok = false;
            break;
          }
        }
        tries++;
      } while (!ok && tries < 300);

      el.style.left = x + "px";
      el.style.top = y + "px";
      placed.push({ x, y, w, h });
    }
  }

  /* ===== ë‹¨ì–´ í´ë¦­: í•˜ì´ë¼ì´íŠ¸ë§Œ ===== */
  function handleWordClick(clientX, clientY) {
    const words = document.querySelectorAll(".word");
    let clicked = null;

    words.forEach(el => {
      const r = el.getBoundingClientRect();
      if (
        clientX >= r.left && clientX <= r.right &&
        clientY >= r.top && clientY <= r.bottom
      ) {
        clicked = el;
      }
      el.classList.remove("word-clicked");
    });

    if (clicked) {
      clicked.classList.add("word-clicked");
    }
  }

  /* ===== ì •ë‹µ ì…ë ¥ ì²˜ë¦¬ ===== */
  function submitAnswer() {
    if (!answerInput || !answerFeedbackEl) return;
    const val = (answerInput.value || "").trim();
    if (!val) return;
    if (timeLeft <= 0) return;

    // ìƒˆ ì…ë ¥ ì‹œ, ì´ì „ ì •ë‹µ ì¹´ë“œ/ë¬¸êµ¬ ì´ˆê¸°í™”
    if (feedbackTimer) {
      clearTimeout(feedbackTimer);
      feedbackTimer = null;
    }

    answerFeedbackEl.textContent = "";
    answerFeedbackEl.style.color = "#FFFFFF";
    answerDisplay.style.display = "none";
    // ì œëª©ì€ ìˆ¨ê²¨ì ¸ ìˆê¸° ë•Œë¬¸ì— í…ìŠ¤íŠ¸ë§Œ ì´ˆê¸°í™”
    mainTitleEl.textContent = "";
    mainSubEl.textContent = "ì œì£¼ì–´ë¥¼ ì°¾ì•„ ì•„ë˜ ì…ë ¥ì¹¸ì— ì ì–´ë³´ì„¸ìš”.";
    mainSubEl.classList.add("main-big-title");

    // ëª©ë¡ì— ì—†ëŠ” ë‹¨ì–´ => ê·¸ëƒ¥ í”¼ë“œë°±ë§Œ
    if (!WORDS.includes(val)) {
      wrongAnswers.push(val);
      answerFeedbackEl.textContent = "ëª©ë¡ì— ì—†ëŠ” ë‹¨ì–´ì˜ˆìš”. ë‹¤ì‹œ í•œ ë²ˆ í™•ì¸í•´ë³¼ê¹Œìš”?";
      answerFeedbackEl.style.color = "#FFE8EC";
      answerInput.value = "";
      return;
    }

    const meaning = MEANINGS[val] || "";

    // ì •ë‹µ ìƒíƒœ í‘œì‹œ: ì œëª©/ì„¤ëª… ë°”ê¾¸ê³  ì…ë ¥ì¹¸ ìˆ¨ê¸°ê³  í° ë°•ìŠ¤ë§Œ ë³´ì—¬ì£¼ê¸°
    mainTitleEl.textContent = ""; // ë³´ì´ì§€ ì•ŠìŒ
    mainSubEl.textContent = "ì •ë‹µ!";
    mainSubEl.classList.remove("main-big-title");
    answerDisplay.textContent = meaning ? `${val} : ${meaning}` : val;
    answerDisplay.style.display = "block";
    if (inputRow) inputRow.style.display = "none";

    if (foundSet.has(val)) {
      // ì´ë¯¸ ì°¾ì€ ë‹¨ì–´
      answerFeedbackEl.textContent = "ì´ë¯¸ ì°¾ì€ ì œì£¼ì–´ì˜ˆìš”!";
      answerFeedbackEl.style.color = "#FFF8C9";
    } else {
      // ìƒˆë¡œ ì°¾ì€ ë‹¨ì–´
      foundSet.add(val);
      correctWords.push(val);
      score++;
      updateScore();
      answerFeedbackEl.textContent = "";
    }

    // í™”ë©´ì—ì„œ í•´ë‹¹ ë‹¨ì–´ ì œê±° (ì°¾ì•„ì„œ ì…ë ¥í•œ ì œì£¼ì–´ëŠ” ì§€ì›Œì§€ê²Œ)
    const wordEls = document.querySelectorAll(".word");
    wordEls.forEach(el => {
      if (el.textContent.trim() === val) {
        el.remove();
      }
    });

    // 2.5ì´ˆ ë’¤ì— ì¸í’‹ì¹¸ ë‹¤ì‹œ ë“±ì¥ + ê¸°ë³¸ ìƒíƒœë¡œ ë¦¬ì…‹
    feedbackTimer = setTimeout(() => {
      answerDisplay.style.display = "none";
      mainTitleEl.textContent = "";
      mainSubEl.textContent = "ì œì£¼ì–´ë¥¼ ì°¾ì•„ ì•„ë˜ ì…ë ¥ì¹¸ì— ì ì–´ë³´ì„¸ìš”.";
      mainSubEl.classList.add("main-big-title");
      answerFeedbackEl.textContent = "";
      if (inputRow) inputRow.style.display = "flex";
      answerInput.value = "";
      answerInput.focus();
    }, 2500);
  }

  if (answerBtn) {
    answerBtn.addEventListener("click", submitAnswer);
  }

  if (answerInput) {
    answerInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        submitAnswer();
      }
    });
  }

  /* ===== 50ì´ˆ íƒ€ì´ë¨¸ ===== */
  let timeLeft = 50;
  let timerId = null;

  function formatTime(sec) {
    const m = String(Math.floor(sec / 60)).padStart(2, "0");
    const s = String(sec % 60).padStart(2, "0");
    return `${m}:${s}`;
  }

  function updateTime() {
    if (!timePill) return;
    timePill.textContent = `ë‚¨ì€ ì‹œê°„ | ${formatTime(timeLeft)}`;
  }

  function startTimer() {
    if (timerId) clearInterval(timerId);
    updateTime();
    timerId = setInterval(() => {
      timeLeft--;
      if (timeLeft <= 0) {
        timeLeft = 0;
        updateTime();
        clearInterval(timerId);
        showResultPage();
      } else {
        updateTime();
      }
    }, 1000);
  }

  /* ===== ê²°ê³¼ í™”ë©´ ===== */
  function renderResultWords() {
    if (!resultWordsCloud || !resultWordsPanel) return;

    resultWordsCloud.innerHTML = "";
    if (!correctWords.length) {
      resultWordsPanel.style.display = "none";
      return;
    }
    resultWordsPanel.style.display = "block";

    correctWords.forEach(word => {
      const chip = document.createElement("div");
      chip.className = "result-word-chip";
      chip.textContent = word;
      resultWordsCloud.appendChild(chip);
    });
  }

  function showResultPage() {
    if (!resultScreen) return;

    resultTitleEl.textContent = `ì œì£¼ì–´ ${score}ê°œ íšë“!`;
    renderResultWords();

    resultScreen.style.display = "block";
    requestAnimationFrame(() => {
      resultScreen.style.opacity = 1;
    });
  }

  // "ì²˜ìŒìœ¼ë¡œ" â†’ index.htmlì˜ circle ë‹¨ê³„ë¡œ ì´ë™
  window.goToMainFromResult = function() {
    window.location.href = "index.html#circle";
  };

  /* ===========================
     ì¤„ ìº”ë²„ìŠ¤
  ============================ */
  const cvs = document.getElementById("cv");
  const ctx = cvs.getContext("2d");
  const DPR = Math.min(window.devicePixelRatio || 1, 2);

  const ROWS = 30;
  const COLS = 20;
  const THICK = 24 * DPR;
  const GAP_Y = 0 * DPR;
  const COL_GAP = -20 * DPR;
  const MARGIN_X = -10 * DPR;
  const MARGIN_Y = 310 * DPR;

  const BASE_LEN_FRAC = 0.68;
  const EXTRA_LEN = 80 * DPR;

  const REACT_R = 40 * DPR;
  const REACT_SPD = 0.48;
  const RETURN_SPD = 0.28;
  const ANGLE_LIMIT = 85 * Math.PI / 180;
  const EXTRA_STEP_X = 40 * DPR;

  const LINE_COLORS = ["#00D9FF", "#45E0E8", "#BBF8FD"];
  const randomColor = () => LINE_COLORS[Math.floor(Math.random() * LINE_COLORS.length)];

  let Wc = 0, Hc = 0, COL_W = 0;
  const segs = [];

  const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
  const lerpAngle = (a, b, t) => {
    const TAU = Math.PI * 2;
    let d = (b - a + Math.PI) % TAU - Math.PI;
    return a + d * t;
  };

  function drawCapsulePath(ax, ay, ang, len, thick) {
    const r = thick / 2;
    ctx.translate(ax, ay);
    ctx.rotate(ang);
    ctx.beginPath();
    ctx.moveTo(r, -r);
    ctx.lineTo(len - r, -r);
    ctx.arc(len - r, 0, r, -Math.PI / 2, Math.PI / 2);
    ctx.lineTo(r, r);
    ctx.arc(r, 0, r, Math.PI / 2, -Math.PI / 2);
    ctx.closePath();
  }

  function fillCapsule(ax, ay, ang, len, thick, fill, alpha = 1) {
    ctx.save();
    ctx.globalAlpha = alpha;
    drawCapsulePath(ax, ay, ang, len, thick);
    ctx.fillStyle = fill;
    ctx.fill();
    ctx.restore();
  }

  function distPointToRotatedSegment(px, py, ax, ay, ang, len) {
    const bx = ax + Math.cos(ang) * len;
    const by = ay + Math.sin(ang) * len;
    const vx = bx - ax, vy = by - ax;
    const wx = px - ax, wy = py - ay;

    const c1 = vx * wx + vy * wy;
    if (c1 <= 0) return Math.hypot(px - ax, py - ay);
    const c2 = vx * vx + vy * vy;
    if (c2 <= c1) return Math.hypot(px - bx, py - by);

    const t = c1 / c2;
    const qx = ax + t * vx;
    const qy = ay + t * vy;
    return Math.hypot(px - qx, py - qy);
  }

  function resize() {
    Wc = cvs.width = Math.floor(window.innerWidth * DPR);
    Hc = cvs.height = Math.floor(window.innerHeight * DPR);
    cvs.style.width = window.innerWidth + "px";
    cvs.style.height = window.innerHeight + "px";
    layout();
  }

  window.addEventListener("resize", () => {
    resize();
    placeWords();   // ë¦¬ì‚¬ì´ì¦ˆí•´ë„ ê²¹ì¹˜ì§€ ì•Šê²Œ ë‹¤ì‹œ ë°°ì¹˜ (ì´ë¯¸ ì°¾ì€ ë‹¨ì–´ëŠ” ì œì™¸)
  });

  function layout() {
    segs.length = 0;

    const totalGap = COL_GAP * (COLS - 1);
    COL_W = (Wc - MARGIN_X * 2 - totalGap) / COLS;

    const baseStepX = COL_W + COL_GAP;
    const stepX = baseStepX + EXTRA_STEP_X;

    const totalH = ROWS * THICK + (ROWS - 1) * GAP_Y;
    const startY = Math.max(MARGIN_Y, (Hc - totalH) / 2) + THICK / 2;
    const startX = MARGIN_X;

    for (let r = 0; r < ROWS; r++) {
      const cy = startY + r * (THICK + GAP_Y);
      for (let c = 0; c < COLS; c++) {
        const colLeft = startX + c * stepX;
        const baseLen = COL_W * BASE_LEN_FRAC + EXTRA_LEN;
        segs.push({
          anchor: { x: colLeft, y: cy },
          base:   { angle: 0, length: baseLen },
          cur:    { angle: 0, length: baseLen },
          color:  randomColor()
        });
      }
    }
  }

  const pointer = { x: 0, y: 0, down: false };

  function setPos(e) {
    if (e.touches && e.touches[0]) {
      pointer.x = e.touches[0].clientX * DPR;
      pointer.y = e.touches[0].clientY * DPR;
    } else {
      pointer.x = e.clientX * DPR;
      pointer.y = e.clientY * DPR;
    }
  }

  cvs.addEventListener("mousemove", setPos, { passive: true });

  cvs.addEventListener("mousedown", (e) => {
    setPos(e);
    pointer.down = true;
    handleWordClick(e.clientX, e.clientY);
  });

  window.addEventListener("mouseup", () => {
    pointer.down = false;
  });

  cvs.addEventListener("touchstart", (e) => {
    setPos(e);
    pointer.down = true;
    const t = e.touches[0];
    handleWordClick(t.clientX, t.clientY);
  }, { passive: false });

  cvs.addEventListener("touchmove", (e) => {
    setPos(e);
    e.preventDefault();
  }, { passive: false });

  window.addEventListener("touchend", () => {
    pointer.down = false;
  });

  function frame() {
    ctx.clearRect(0, 0, Wc, Hc);

    for (const s of segs) {
      s.cur.length = s.base.length;
      let target = 0;

      if (pointer.down) {
        const d = distPointToRotatedSegment(
          pointer.x, pointer.y,
          s.anchor.x, s.anchor.y,
          s.cur.angle, s.cur.length
        );
        if (d <= REACT_R) {
          target = Math.max(-ANGLE_LIMIT, Math.min(
            ANGLE_LIMIT,
            Math.atan2(pointer.y - s.anchor.y, pointer.x - s.anchor.x)
          ));
        }
      }

      s.cur.angle = lerpAngle(
        s.cur.angle,
        target,
        pointer.down ? REACT_SPD : RETURN_SPD
      );

      fillCapsule(
        s.anchor.x,
        s.anchor.y,
        s.cur.angle,
        s.cur.length,
        THICK,
        s.color,
        1
      );
    }

    requestAnimationFrame(frame);
  }

  // ì´ˆê¸° ìƒíƒœ ì„¸íŒ…
  placeWords();
  resize();
  requestAnimationFrame(frame);
  startTimer();
})();

/* ğŸŒŠ í˜ì´ì§€ ë“¤ì–´ì˜¨ ë’¤ë¶€í„° ê²°ê³¼ í™”ë©´ê¹Œì§€ íŒŒë„ì†Œë¦¬ ì¬ìƒ */
window.addEventListener("load", () => {
  const bg = document.getElementById("bg-waves");
  if (!bg) return;
  try {
    bg.currentTime = 0;
    bg.play();
  } catch (e) {
    // ë¸Œë¼ìš°ì € ìë™ì¬ìƒ ì •ì±…ì— ë§‰í˜€ë„ ì¡°ìš©íˆ ë¬´ì‹œ
  }
});
</script>
</body>
</html>
